# دليل شامل لتشغيل n8n واستيراد سير العمل

## مقدمة عن n8n

**n8n** هي منصة أتمتة سير العمل مفتوحة المصدر وقوية تتيح لك ربط التطبيقات والخدمات المختلفة ببعضها البعض وأتمتة المهام المتكررة. في سياق وكيل الذكاء الاصطناعي الخاص بنا، تلعب n8n دوراً حاسماً في:

*   **جمع البيانات من الإنترنت:** من مصادر مثل GitHub و Dribbble و Stack Overflow.
*   **معالجة البيانات:** تحويل البيانات المجمعة إلى صيغة قابلة للاستخدام.
*   **التكامل مع الواجهة الخلفية:** إرسال البيانات المعالجة إلى API الوكيل.
*   **تنفيذ المهام المؤتمتة:** تشغيل سير العمل بناءً على جداول زمنية أو أحداث محددة.

## المتطلبات الأساسية

قبل البدء، تأكد من أن لديك:

*   **Docker و Docker Compose:** لتشغيل n8n و PostgreSQL في حاويات.
*   **اتصال إنترنت:** لتحميل صور Docker وجلب البيانات من الإنترنت.
*   **متصفح ويب:** للوصول إلى واجهة n8n.

## خطوات التشغيل

### 1. تشغيل الخدمات باستخدام Docker Compose

انتقل إلى مجلد المشروع الرئيسي وقم بتشغيل Docker Compose:

```bash
cd /path/to/ai-agent-project
docker-compose up --build -d
```

هذا الأمر سيقوم بـ:
*   تحميل صور Docker الضرورية.
*   إنشاء وتشغيل حاويات PostgreSQL و n8n و Redis.
*   تهيئة قاعدة البيانات باستخدام ملف `init-db.sql`.

**ملاحظة:** قد يستغرق التشغيل الأول بعض الوقت (5-10 دقائق) بسبب تحميل الصور.

### 2. التحقق من حالة الخدمات

للتحقق من أن جميع الخدمات تعمل بشكل صحيح:

```bash
docker-compose ps
```

يجب أن ترى شيئاً مشابهاً لهذا:

```
NAME                 COMMAND                  SERVICE             STATUS              PORTS
ai-agent-postgres    "docker-entrypoint..."   postgres            Up 2 minutes        5432/tcp
ai-agent-n8n         "dumb-init node ..."     n8n                 Up 2 minutes        5678/tcp
ai-agent-redis       "redis-server"           redis               Up 2 minutes        6379/tcp
```

### 3. الوصول إلى واجهة n8n

افتح متصفحك وانتقل إلى:

```
http://localhost:5678
```

ستظهر لك صفحة تسجيل الدخول. استخدم بيانات الاعتماد التالية:

*   **اسم المستخدم:** `admin`
*   **كلمة المرور:** `admin123`

بعد تسجيل الدخول، ستصل إلى لوحة التحكم الرئيسية لـ n8n.

## استيراد سير العمل المسبقة

لقد قمنا بإعداد 5 سير عمل مسبقة في ملف `n8n-workflows.json`. إليك كيفية استيرادها:

### الطريقة 1: الاستيراد اليدوي من الملف

1.  من لوحة التحكم الرئيسية، انقر على **"Workflows"** في القائمة الجانبية.
2.  انقر على زر **"Import"** (أو **"+"**).
3.  اختر **"From File"** (من ملف).
4.  حدد ملف `n8n-workflows.json` من مجلد المشروع.
5.  انقر على **"Import"**.

### الطريقة 2: الاستيراد عبر API

يمكنك أيضاً استيراد سير العمل برمجياً باستخدام API الخاص بـ n8n:

```bash
curl -X POST http://localhost:5678/api/v1/workflows \
  -H "Content-Type: application/json" \
  -H "X-N8N-API-KEY: YOUR_API_KEY" \
  -d @n8n-workflows.json
```

**ملاحظة:** ستحتاج إلى الحصول على مفتاح API من إعدادات n8n.

## سير العمل المسبقة المتضمنة

### 1. جمع البيانات من GitHub

**الهدف:** جمع أمثلة الكود من GitHub لتعليم الوكيل البرمجة.

**الجدول الزمني:** يومياً في منتصف الليل (00:00).

**الخطوات:**
1.  البحث عن مستودعات JavaScript الشهيرة على GitHub.
2.  استخراج معلومات المستودع (الاسم، الرابط، لغة البرمجة).
3.  إرسال البيانات إلى API الوكيل (`/api/agent/knowledge`).

### 2. جمع موارد التصميم

**الهدف:** جمع أمثلة تصميم من Dribbble و Behance.

**الجدول الزمني:** يومياً في الساعة 06:00 صباحاً.

**الخطوات:**
1.  جلب أحدث التصاميم من Dribbble.
2.  استخراج معلومات التصميم (العنوان، الوصف، الصور).
3.  إرسال البيانات إلى API الوكيل.

**ملاحظة:** ستحتاج إلى إدراج رمز Dribbble API في ملف `n8n-workflows.json`.

### 3. تحديث معرفة الأتمتة

**الهدف:** جمع أمثلة سير العمل والأتمتة من المصادر المفتوحة.

**الجدول الزمني:** يومياً في الساعة 12:00 ظهراً.

**الخطوات:**
1.  جلب قوالب الأتمتة من Zapier.
2.  معالجة البيانات واستخراج المعلومات ذات الصلة.
3.  إرسال البيانات إلى API الوكيل.

### 4. مراقبة المهام وتحديثها

**الهدف:** التحقق من حالة المهام وتحديثها تلقائياً.

**الجدول الزمني:** كل 5 دقائق.

**الخطوات:**
1.  جلب قائمة المهام المعلقة من API الوكيل.
2.  التحقق من حالة كل مهمة.
3.  تحديث حالة المهام إلى "قيد التنفيذ" (in_progress).

### 5. إرسال تقارير التقدم

**الهدف:** إرسال تقارير يومية عن تقدم الوكيل.

**الجدول الزمني:** يومياً في الساعة 18:00 مساءً.

**الخطوات:**
1.  جلب حالة الوكيل الحالية.
2.  جمع إحصائيات المعرفة المكتسبة.
3.  توليد تقرير شامل.
4.  إرسال التقرير عبر البريد الإلكتروني.

## تخصيص سير العمل

### تغيير الجدول الزمني

لتغيير الجدول الزمني لسير عمل معينة:

1.  افتح سير العمل في محرر n8n.
2.  انقر على عقدة **"Schedule"** (الجدولة).
3.  عدّل الجدول الزمني حسب احتياجاتك (يومي، أسبوعي، كل X دقيقة، إلخ).
4.  احفظ التغييرات.

### إضافة مصادر بيانات جديدة

لإضافة مصدر بيانات جديد:

1.  افتح سير العمل في محرر n8n.
2.  أضف عقدة HTTP جديدة.
3.  أدخل عنوان URL ومعاملات الطلب.
4.  قم بتوصيل العقدة بباقي سير العمل.
5.  احفظ التغييرات.

### تكوين المصادقة

بعض المصادر تتطلب مصادقة (مثل Dribbble و GitHub):

1.  انتقل إلى **"Credentials"** (بيانات الاعتماد) في القائمة الجانبية.
2.  انقر على **"Create New"** (إنشاء جديد).
3.  اختر نوع المصادقة (OAuth، API Key، إلخ).
4.  أدخل بيانات الاعتماد الخاصة بك.
5.  احفظ بيانات الاعتماد.
6.  استخدمها في سير العمل.

## استكشاف الأخطاء

### سير العمل لا تعمل

**الحل:**
1.  تحقق من سجلات n8n: انقر على **"Logs"** في لوحة التحكم.
2.  تأكد من أن API الوكيل يعمل بشكل صحيح.
3.  تحقق من الاتصال بالإنترنت.

### خطأ في الاتصال بـ PostgreSQL

**الحل:**
1.  تأكد من أن حاوية PostgreSQL تعمل: `docker-compose ps`.
2.  تحقق من بيانات الاعتماد في `docker-compose.yml`.
3.  أعد تشغيل الخدمات: `docker-compose restart postgres`.

### n8n لا يستجيب

**الحل:**
1.  أعد تشغيل حاوية n8n: `docker-compose restart n8n`.
2.  تحقق من السجلات: `docker-compose logs n8n`.
3.  تأكد من توفر موارد النظام (CPU، الذاكرة).

## الخطوات التالية

بعد إعداد n8n بنجاح:

1.  **اختبر سير العمل:** قم بتشغيل سير عمل واحدة يدوياً للتحقق من أنها تعمل بشكل صحيح.
2.  **راقب النتائج:** تحقق من أن البيانات يتم جمعها بشكل صحيح وإرسالها إلى API الوكيل.
3.  **ضبط الجداول الزمنية:** عدّل الجداول الزمنية حسب احتياجاتك.
4.  **أضف سير عمل جديدة:** قم بإنشاء سير عمل مخصصة لاحتياجاتك الخاصة.

---

**ملاحظة:** هذا الدليل يوفر نظرة عامة على كيفية تشغيل n8n واستيراد سير العمل. للحصول على مزيد من المعلومات التفصيلية، يرجى الرجوع إلى [التوثيق الرسمي لـ n8n](https://docs.n8n.io).
